function setStorage(e){localStorage.setItem("tinymce_autocomplete",e)}function search1(e,t,o){o=o||[];for(var n=e.length,a=0;n>a;a++)if(e[a].length>t.length&&0==e[a].indexOf(t)&&-1==o.indexOf(e[a]))return a;return-1}function search2(e,t){for(var o=e.length,n=0;o>n;n++)if(e[n][0]==t)return n;return-1}var autocomplete=!0,options={enter:!0,tab:!0},prev=[],boolauto=!1,words=words||[],mwords=mwords||[];"undefined"!=typeof Storage&&(null!=localStorage.getItem("tinymce_autocomplete")?autocomplete="false"!=localStorage.getItem("tinymce_autocomplete"):setStorage("true"),null!=localStorage.getItem("tinymce_autocomplete_options")&&(options=JSON.parse(localStorage.getItem("tinymce_autocomplete_options")))),function(){tinymce.PluginManager.add("tinymce_autocomplete",function(e,t){function o(e,t){e.setContent(t),e.getNode().normalize()}function n(){var t=document.createElement("style");t.className="autocompleteSelectionColor",t.innerHTML="::-moz-selection{color:#999999;background:#ffffff;}::selection{color:#999999;background:#ffffff;}",e.getBody().appendChild(t)}function a(t,o,n){var a,r;a=e.getWin().getSelection(),a.removeAllRanges(),r=document.createRange(),r.setStart(t,o),r.setEnd(t,o+n),a.addRange(r)}function r(){for(var t=e.getDoc().getElementsByClassName("autocompleteSelectionColor"),o=0;o<t.length;o++)t[o].parentNode.removeChild(t[o])}function c(t,r,c){var l,i=0,s="",g=0;if(l=e.selection,!(-1!=t.charAt(r).search(/[a-z]/i)&&9!=c||(content=t.substring(0,r),i=content.match(/[a-z]*$/i).index,content=content.substring(i,r).toLowerCase().trim(),0!=i&&(s=t.substring(0,i-1),g=s.match(/[a-z]*$/i).index,s=s.substring(g,i-1).trim()),content.length<2))){var u,p,d,m="";if(s.length>0&&(u=s.charCodeAt(0),u=u>96?u-97:u-39,p=search2(mwords[u],s),-1!=p&&(d=search1(mwords[u][p],content,[s].concat(prev)),-1!=d&&(m=mwords[u][p][d],0==prev.length?prev=[m]:prev.push(m)))),("undefined"==typeof m||0==m.length)&&(u=26*(content.charCodeAt(0)-97)+(content.charCodeAt(1)-97),p=search1(words[u],content,prev),-1==p?prev.length>0&&prev[prev.length-1].startsWith(content)&&(m=prev[prev.length-1]):(m=words[u][p],0==prev.length?prev=[m]:prev.push(m))),m.length>0){boolauto=!0,m=m.substring(content.length);var f=l.getRng().startContainer;o(l,m),n(),a(f,r,m.length)}}}e.addButton("tinymce_autocomplete",{title:"Autocomplete Toggle",image:t+"/image/automatic-flash-symbol.png",onPostRender:function(){autocomplete&&this.active(!0)},onclick:function(){var e=!this.active();this.active(e),e?(autocomplete=!0,setStorage("true")):(autocomplete=!1,setStorage("false"))}}),e.on("keyDown",function(t){var o,n=0;o=e.selection,n=t.which||t.keyCode||0,32==n&&(o=e.selection,0==o.getRng().collapsed&&(t.preventDefault(),o.setContent("&nbsp;"))),13==n&&options.enter&&1==boolauto&&o.getContent().length>0&&(t.preventDefault(),a(o.getRng().startContainer,o.getRng().endOffset,0)),8==n&&1==boolauto&&(o.getContent().length>0&&o.setContent(""),boolauto=!1),9==n&&options.tab&&1==boolauto&&o.getContent().length>0&&t.preventDefault()}),e.on("keyUp",function(t){if(0==boolauto&&(prev=[]),boolauto=!1,0!=autocomplete){var o=t.which||t.keyCode||0;if(8==o&&(prev.pop(),prev.pop()),o>64&&91>o||o>96&&123>o||222==o||9==o&&options.tab){var n,a="",r=0;n=e.selection,n.getNode().normalize(),a=n.getRng().startContainer.textContent,a=a.replace(/\u00a0/g," "),r=n.getRng().startOffset,c(a,r,o)}}}),e.on("loadContent",function(t){e.getBody().addEventListener("click",r),e.getBody().addEventListener("keydown",r),e.getBody().addEventListener("mousedown",r)})})}();